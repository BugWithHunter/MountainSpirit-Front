<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bughunters.mountainspirit.climbhistory.query.mapper.ClimbHistoryQueryRepository">
<resultMap id="findClimbCheckResultMap" type="com.bughunters.mountainspirit.climbhistory.query.dto.FindClimbCheckQueryDTO">
    <result property="memberName" column="memberName"/>
    <result property="updateTime" column="updateTime"/>
    <result property="endTime" column="endTime"/>
    <result property="frtrlNm" column="frtrlNm"/>
    <result property="placeNm" column="placeNm"/>
    <result property="stateCode" column="stateCode"/>
    <result property="id" column="id"/>
</resultMap>
<resultMap id="findNotCompleteClimbCheckResultMap" type="com.bughunters.mountainspirit.climbhistory.query.dto.FindNotCompleteClimbCheckQueryDTO">
    <result property="memberName" column="memberName"/>
    <result property="updateTime" column="updateTime"/>
    <result property="endTime" column="endTime"/>
    <result property="frtrlId" column="frtrlId"/>
    <result property="frtrlNm" column="frtrlNm"/>
    <result property="poiId" column="poiId"/>
    <result property="placeNm" column="placeNm"/>
    <result property="stateCode" column="stateCode"/>
    <result property="id" column="id"/>
</resultMap>
    <select id="selectClimbCheckByMember"
            parameterType="com.bughunters.mountainspirit.climbhistory.query.dto.RequestStartClimbMountainQueryDTO"
            resultMap="findClimbCheckResultMap">
        SELECT
               b.memName as memberName
              , a.updateTime
              , a.endTime
              , c.frtrlNm
              , d.placeNm
              , a.stateCode
              , a.id
          FROM ClimbCheck a
          JOIN Member b on a.cumId = b.id
          JOIN Mountain c on a.frtrlId = c.frtrlId
          JOIN Course d on a.poiId = d.poiId
         WHERE a.cumId = #{cumId}
           AND a.frtrlId = #{frtrlId}
           ANd a.poiId = #{poiId}
           AND a.stateCode = #{stateCode}
           AND a.updateTime >= SUBDATE(now(), INTERVAL 30 day);
    </select>

    <select id="selectAllClimbCheckByMember"
            parameterType="com.bughunters.mountainspirit.climbhistory.query.dto.RequestStartClimbMountainQueryDTO"
            resultMap="findNotCompleteClimbCheckResultMap">
        SELECT
        b.memName as memberName
        , a.updateTime
        , a.endTime
        , c.frtrlId
        , c.frtrlNm
        , d.poiId
        , d.placeNm
        , a.stateCode
        , a.id
        FROM ClimbCheck a
        JOIN Member b on a.cumId = b.id
        JOIN Mountain c on a.frtrlId = c.frtrlId
        JOIN Course d on a.poiId = d.poiId
        WHERE a.cumId = #{cumId}
        AND a.stateCode = #{stateCode}
        AND a.updateTime >= SUBDATE(now(), INTERVAL 30 day);
    </select>
</mapper>


